# åéƒ¨æš‚å­˜åŒºçŠ¶æ€ç®¡ç†è¯´æ˜

## ğŸ“– æ¦‚è¿°

æœ¬ç³»ç»Ÿå®ç°äº†æœºå™¨äººåéƒ¨æš‚å­˜åŒºçŠ¶æ€çš„æŒä¹…åŒ–ç®¡ç†ï¼Œæ‰€æœ‰å¯¹æš‚å­˜åŒºçš„ä¿®æ”¹éƒ½ä¼šè‡ªåŠ¨ä¿å­˜åˆ°æ–‡ä»¶ä¸­ï¼Œç¨‹åºé‡å¯åå¯ä»¥æ¢å¤ä¹‹å‰çš„çŠ¶æ€ã€‚

---

## ğŸ¯ ä¸»è¦åŠŸèƒ½

### 1. **çŠ¶æ€æŒä¹…åŒ–**
- æš‚å­˜åŒºçŠ¶æ€è‡ªåŠ¨ä¿å­˜åˆ° `storage_state.json` æ–‡ä»¶
- æ¯æ¬¡æ›´æ–°æš‚å­˜åŒºï¼ˆæ”¾ç½®ç“¶å­ï¼‰æ—¶è‡ªåŠ¨ä¿å­˜
- ç¨‹åºé€€å‡ºæ—¶æ˜¾ç¤ºæœ€ç»ˆçŠ¶æ€

### 2. **å¯åŠ¨æ—¶é€‰æ‹©**
- æ£€æµ‹å†å²çŠ¶æ€æ–‡ä»¶
- æ˜¾ç¤ºå½“å‰æš‚å­˜åŒºå ç”¨æƒ…å†µ
- å…è®¸ç”¨æˆ·é€‰æ‹©æ˜¯å¦æ¸…é›¶

### 3. **å®æ—¶åŒæ­¥**
- æ‰€æœ‰æš‚å­˜åŒºä¿®æ”¹éƒ½ä¼šç«‹å³åŒæ­¥åˆ°æ–‡ä»¶
- å¤šä¸ªç“¶å­ç±»å‹ç‹¬ç«‹ç®¡ç†
- æ”¯æŒæŸ¥è¯¢ç©ºæ§½ä½ã€æ£€æŸ¥æ˜¯å¦å·²æ»¡

---

## ğŸ“‚ ç›¸å…³æ–‡ä»¶

### æ ¸å¿ƒæ–‡ä»¶

| æ–‡ä»¶ | è¯´æ˜ |
|------|------|
| `constants.py` | å®šä¹‰é»˜è®¤æš‚å­˜åŒºé…ç½® `DEFAULT_BACK_TEMP_STORAGE` |
| `storage_manager.py` | å­˜å‚¨ç®¡ç†å™¨ï¼Œè´Ÿè´£è¯»å–/ä¿å­˜/æ›´æ–°æš‚å­˜åŒºçŠ¶æ€ |
| `storage_state.json` | è¿è¡Œæ—¶çŠ¶æ€æ–‡ä»¶ï¼ˆè‡ªåŠ¨ç”Ÿæˆï¼Œä¼šè¢« .gitignore å¿½ç•¥ï¼‰ |
| `cmd_handler.py` | å‘½ä»¤å¤„ç†å™¨ï¼Œä½¿ç”¨å­˜å‚¨ç®¡ç†å™¨æ›´æ–°æš‚å­˜åŒº |
| `main.py` | å¯åŠ¨æ—¶åˆå§‹åŒ–å­˜å‚¨ç®¡ç†å™¨ï¼Œé€€å‡ºæ—¶ä¿å­˜çŠ¶æ€ |

---

## ğŸš€ ä½¿ç”¨æµç¨‹

### å¯åŠ¨ç¨‹åº

```bash
python main.py
```

### é¦–æ¬¡å¯åŠ¨ï¼ˆæ— å†å²çŠ¶æ€ï¼‰

```
======================================================================
åéƒ¨æš‚å­˜åŒºçŠ¶æ€ç®¡ç†
======================================================================
æœªæ£€æµ‹åˆ°å†å²çŠ¶æ€æ–‡ä»¶ï¼Œå°†ä½¿ç”¨é»˜è®¤é…ç½®ï¼ˆå…¨ç©ºï¼‰

âœ“ æš‚å­˜åŒºçŠ¶æ€å·²é‡ç½®ä¸ºå…¨ç©º

å½“å‰æš‚å­˜åŒºçŠ¶æ€:
============================================================
glass_bottle_1000:
  å ç”¨: 0/4
  çŠ¶æ€: [0, 0, 0, 0]
glass_bottle_500:
  å ç”¨: 0/4
  çŠ¶æ€: [0, 0, 0, 0]
glass_bottle_250:
  å ç”¨: 0/4
  çŠ¶æ€: [0, 0, 0, 0]
============================================================
```

### å†æ¬¡å¯åŠ¨ï¼ˆæœ‰å†å²çŠ¶æ€ï¼‰

```
======================================================================
åéƒ¨æš‚å­˜åŒºçŠ¶æ€ç®¡ç†
======================================================================
æ£€æµ‹åˆ°å†å²æš‚å­˜åŒºçŠ¶æ€æ–‡ä»¶: storage_state.json

å½“å‰ä¿å­˜çš„æš‚å­˜åŒºçŠ¶æ€:
------------------------------------------------------------
glass_bottle_1000: 2/4 å·²å ç”¨, çŠ¶æ€: ['bottle_001', 'bottle_002', 0, 0]
glass_bottle_500: 1/4 å·²å ç”¨, çŠ¶æ€: ['bottle_003', 0, 0, 0]
glass_bottle_250: 0/4 å·²å ç”¨, çŠ¶æ€: [0, 0, 0, 0]
------------------------------------------------------------

æ˜¯å¦é‡ç½®æš‚å­˜åŒºçŠ¶æ€ä¸ºå…¨ç©ºï¼Ÿ(y/n) [é»˜è®¤: n]: 
```

#### é€‰é¡¹è¯´æ˜

- **è¾“å…¥ `n` æˆ–ç›´æ¥å›è½¦**ï¼šä¿ç•™å†å²çŠ¶æ€ï¼Œç»§ç»­ä½¿ç”¨
- **è¾“å…¥ `y`**ï¼šæ¸…ç©ºæ‰€æœ‰æš‚å­˜åŒºï¼Œä»å¤´å¼€å§‹

---

## ğŸ”§ é»˜è®¤é…ç½®

åœ¨ `constants.py` ä¸­å®šä¹‰ï¼š

```python
DEFAULT_BACK_TEMP_STORAGE = {
    "glass_bottle_1000": [0, 0, 0, 0],  # 1Lç»ç’ƒç“¶ï¼Œ4ä¸ªæ§½ä½
    "glass_bottle_500": [0, 0, 0, 0],   # 500mlç»ç’ƒç“¶ï¼Œ4ä¸ªæ§½ä½
    "glass_bottle_250": [0, 0, 0, 0]    # 250mlç»ç’ƒç“¶ï¼Œ4ä¸ªæ§½ä½
}
```

- **0** è¡¨ç¤ºç©ºæ§½ä½
- **å­—ç¬¦ä¸²** è¡¨ç¤ºè¯¥æ§½ä½å­˜æ”¾çš„ç“¶å­IDï¼ˆå¦‚ `"glass_bottle_1000_001"`ï¼‰

---

## ğŸ“Š storage_state.json æ–‡ä»¶æ ¼å¼

```json
{
    "glass_bottle_1000": [
        "glass_bottle_1000_001",
        "glass_bottle_1000_002",
        0,
        0
    ],
    "glass_bottle_500": [
        "glass_bottle_500_001",
        0,
        0,
        0
    ],
    "glass_bottle_250": [
        0,
        0,
        0,
        0
    ]
}
```

---

## ğŸ” å­˜å‚¨ç®¡ç†å™¨ API

### åˆå§‹åŒ–

```python
from storage_manager import init_storage_manager, get_storage_manager

# åˆå§‹åŒ–ï¼ˆä¸é‡ç½®ï¼‰
init_storage_manager(reset=False)

# åˆå§‹åŒ–å¹¶é‡ç½®ä¸ºç©º
init_storage_manager(reset=True)

# è·å–ç®¡ç†å™¨å®ä¾‹
storage_mgr = get_storage_manager()
```

### å¸¸ç”¨æ–¹æ³•

#### 1. è·å–å½“å‰çŠ¶æ€

```python
storage = storage_mgr.get_storage()
# è¿”å›: {"glass_bottle_1000": [...], ...}
```

#### 2. æ›´æ–°æ§½ä½

```python
# å°†ç“¶å­æ”¾å…¥æŒ‡å®šæ§½ä½
storage_mgr.update_slot(
    bottle_type="glass_bottle_1000",
    slot_index=0,
    bottle_id="glass_bottle_1000_001"
)
# è‡ªåŠ¨ä¿å­˜åˆ°æ–‡ä»¶
```

#### 3. æ¸…ç©ºæ§½ä½

```python
storage_mgr.clear_slot(
    bottle_type="glass_bottle_1000",
    slot_index=0
)
```

#### 4. æŸ¥æ‰¾ç©ºæ§½ä½

```python
index = storage_mgr.get_empty_slot_index("glass_bottle_1000")
# è¿”å›: 0, 1, 2, 3 æˆ– Noneï¼ˆå·²æ»¡ï¼‰
```

#### 5. æ£€æŸ¥æ˜¯å¦å·²æ»¡

```python
# æ£€æŸ¥æ‰€æœ‰æš‚å­˜åŒº
if storage_mgr.is_full():
    print("æ‰€æœ‰æš‚å­˜åŒºå·²æ»¡")

# æ£€æŸ¥ç‰¹å®šç±»å‹
if storage_mgr.is_type_full("glass_bottle_1000"):
    print("1Lç»ç’ƒç“¶æš‚å­˜åŒºå·²æ»¡")
```

#### 6. æ˜¾ç¤ºçŠ¶æ€

```python
print(storage_mgr.display_storage_status())
```

#### 7. æ‰‹åŠ¨ä¿å­˜

```python
storage_mgr.save_storage()
```

#### 8. é‡ç½®çŠ¶æ€

```python
storage_mgr.reset_storage()
storage_mgr.save_storage()
```

---

## ğŸ’¡ åœ¨å‘½ä»¤å¤„ç†å™¨ä¸­çš„ä½¿ç”¨

åœ¨ `cmd_handler.py` çš„ `handle_scan_qrcode` ä¸­ï¼š

```python
def handle_scan_qrcode(self, cmd_data: Dict) -> Dict:
    # è·å–å­˜å‚¨ç®¡ç†å™¨
    storage_mgr = get_storage_manager()
    back_temp_storage = storage_mgr.get_storage()
    
    # æ£€æŸ¥æ˜¯å¦å·²æ»¡
    if storage_mgr.is_full():
        return {"success": False, "message": "æš‚å­˜åŒºå·²æ»¡"}
    
    # æŸ¥æ‰¾ç©ºæ§½ä½
    empty_index = storage_mgr.get_empty_slot_index(object_type)
    if empty_index is None:
        return {"success": False, "message": f"{object_type}æš‚å­˜åŒºå·²æ»¡"}
    
    # æ”¾ç½®ç“¶å­åæ›´æ–°çŠ¶æ€ï¼ˆè‡ªåŠ¨ä¿å­˜ï¼‰
    storage_mgr.update_slot(object_type, empty_index, bottle_id)
    
    return {"success": True}
```

---

## ğŸ”„ å·¥ä½œæµç¨‹

```
ç¨‹åºå¯åŠ¨
    â†“
æ£€æŸ¥ storage_state.json æ˜¯å¦å­˜åœ¨
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æ–‡ä»¶å­˜åœ¨    â”‚           â”‚ æ–‡ä»¶ä¸å­˜åœ¨  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“                         â†“
æ˜¾ç¤ºå†å²çŠ¶æ€              ä½¿ç”¨é»˜è®¤é…ç½®ï¼ˆå…¨ç©ºï¼‰
è¯¢é—®æ˜¯å¦é‡ç½®
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”
â”‚ yé‡ç½® â”‚ nä¿ç•™ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“       â†“
    â””â”€â”€â”€â”¬â”€â”€â”€â”˜
        â†“
  åŠ è½½/åˆå§‹åŒ–çŠ¶æ€
        â†“
   ç¨‹åºè¿è¡Œä¸­...
   â”œâ”€â”€ SCAN_QRCODE æ‰§è¡Œ
   â”œâ”€â”€ æ›´æ–°æš‚å­˜åŒº
   â”œâ”€â”€ è‡ªåŠ¨ä¿å­˜åˆ°æ–‡ä»¶ â†â”€â”
   â””â”€â”€ ç»§ç»­è¿è¡Œ...      â”‚ å®æ—¶åŒæ­¥
                        â”‚
   ç¨‹åºé€€å‡º               â”‚
        â†“                 â”‚
   æ˜¾ç¤ºæœ€ç»ˆçŠ¶æ€          â”‚
   ä¿å­˜åˆ°æ–‡ä»¶ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“‹ ç¨‹åºé€€å‡ºæ—¶çš„è¾“å‡º

```
======================================================================
æœ€ç»ˆæš‚å­˜åŒºçŠ¶æ€:
======================================================================
å½“å‰æš‚å­˜åŒºçŠ¶æ€:
============================================================
glass_bottle_1000:
  å ç”¨: 2/4
  çŠ¶æ€: ['glass_bottle_1000_001', 'glass_bottle_1000_002', 0, 0]
glass_bottle_500:
  å ç”¨: 1/4
  çŠ¶æ€: ['glass_bottle_500_001', 0, 0, 0]
glass_bottle_250:
  å ç”¨: 0/4
  çŠ¶æ€: [0, 0, 0, 0]
============================================================

âœ“ çŠ¶æ€å·²ä¿å­˜åˆ°: storage_state.json
```

---

## ğŸ› ï¸ æ‰‹åŠ¨ç®¡ç†çŠ¶æ€æ–‡ä»¶

### æŸ¥çœ‹å½“å‰çŠ¶æ€

```bash
cat storage_state.json
```

### å¤‡ä»½çŠ¶æ€

```bash
cp storage_state.json storage_state_backup.json
```

### æ¸…ç©ºçŠ¶æ€ï¼ˆæ‰‹åŠ¨ï¼‰

```bash
rm storage_state.json
# ä¸‹æ¬¡å¯åŠ¨ä¼šè‡ªåŠ¨ä½¿ç”¨é»˜è®¤é…ç½®
```

### æ‰‹åŠ¨ç¼–è¾‘çŠ¶æ€

```bash
vim storage_state.json
# ä¿®æ”¹åé‡å¯ç¨‹åº
```

---

## âš ï¸ æ³¨æ„äº‹é¡¹

### 1. æ–‡ä»¶æƒé™
ç¡®ä¿ç¨‹åºæœ‰æƒé™è¯»å†™ `storage_state.json`

### 2. JSON æ ¼å¼
æ‰‹åŠ¨ç¼–è¾‘æ—¶å¿…é¡»ä¿æŒæ­£ç¡®çš„ JSON æ ¼å¼

### 3. æ§½ä½ç´¢å¼•
æ§½ä½ç´¢å¼•ä» 0 å¼€å§‹ï¼ˆ0, 1, 2, 3ï¼‰

### 4. å¹¶å‘å®‰å…¨
å½“å‰å®ç°ä¸ºå•è¿›ç¨‹è®¾è®¡ï¼Œå¤šè¿›ç¨‹åŒæ—¶è¿è¡Œå¯èƒ½å¯¼è‡´çŠ¶æ€ä¸ä¸€è‡´

### 5. Git ç®¡ç†
`storage_state.json` å·²è¢« `.gitignore` å¿½ç•¥ï¼Œä¸ä¼šæäº¤åˆ°ç‰ˆæœ¬åº“

---

## ğŸ› å¸¸è§é—®é¢˜

### Q: å¯åŠ¨æ—¶æ²¡æœ‰è¯¢é—®æ˜¯å¦é‡ç½®ï¼Ÿ
**A:** è¯´æ˜æ²¡æœ‰æ£€æµ‹åˆ°å†å²çŠ¶æ€æ–‡ä»¶ï¼Œä¼šè‡ªåŠ¨ä½¿ç”¨é»˜è®¤é…ç½®ã€‚

### Q: å¦‚ä½•å¼ºåˆ¶æ¸…ç©ºæš‚å­˜åŒºï¼Ÿ
**A:** å¯åŠ¨æ—¶é€‰æ‹© `y` é‡ç½®ï¼Œæˆ–æ‰‹åŠ¨åˆ é™¤ `storage_state.json` æ–‡ä»¶ã€‚

### Q: çŠ¶æ€æ–‡ä»¶æŸåæ€ä¹ˆåŠï¼Ÿ
**A:** åˆ é™¤ `storage_state.json`ï¼Œç¨‹åºä¼šè‡ªåŠ¨é‡æ–°åˆ›å»ºã€‚

### Q: å¦‚ä½•æŸ¥çœ‹å®æ—¶æš‚å­˜åŒºçŠ¶æ€ï¼Ÿ
**A:** åœ¨ä»£ç ä¸­è°ƒç”¨ `storage_mgr.display_storage_status()` æˆ–æŸ¥çœ‹æ—¥å¿—æ–‡ä»¶ã€‚

### Q: ä¿®æ”¹äº† constants.py ä¸­çš„é»˜è®¤é…ç½®ï¼Œå¦‚ä½•ç”Ÿæ•ˆï¼Ÿ
**A:** åˆ é™¤ `storage_state.json`ï¼Œæˆ–å¯åŠ¨æ—¶é€‰æ‹© `y` é‡ç½®ã€‚

---

## ğŸ“ æ—¥å¿—è®°å½•

æ‰€æœ‰æš‚å­˜åŒºæ“ä½œéƒ½ä¼šè®°å½•åˆ°æ—¥å¿—ï¼š

```
[INFO] ç³»ç»Ÿ - æš‚å­˜åŒºçŠ¶æ€å·²é‡ç½®
[INFO] ç³»ç»Ÿ - å·²åŠ è½½å†å²æš‚å­˜åŒºçŠ¶æ€
[INFO] å‘½ä»¤å¤„ç†å™¨ - ç“¶å­ glass_bottle_1000_001 å·²æ”¾ç½®åˆ° glass_bottle_1000[0]
[INFO] å­˜å‚¨ç®¡ç†å™¨ - å­˜å‚¨çŠ¶æ€å·²ä¿å­˜åˆ°: storage_state.json
```

---

## ğŸ‰ æ€»ç»“

- âœ… çŠ¶æ€è‡ªåŠ¨æŒä¹…åŒ–ï¼Œç¨‹åºé‡å¯ä¸ä¸¢å¤±
- âœ… å¯åŠ¨æ—¶å¯é€‰æ‹©æ¢å¤æˆ–é‡ç½®
- âœ… æ¯æ¬¡ä¿®æ”¹å®æ—¶ä¿å­˜åˆ°æ–‡ä»¶
- âœ… é€€å‡ºæ—¶æ˜¾ç¤ºæœ€ç»ˆçŠ¶æ€
- âœ… å®Œæ•´çš„æ—¥å¿—è®°å½•
- âœ… ç®€å•æ˜“ç”¨çš„ API

é€šè¿‡è¿™ä¸ªç³»ç»Ÿï¼Œæœºå™¨äººçš„æš‚å­˜åŒºçŠ¶æ€å¾—åˆ°äº†å®Œæ•´çš„ç®¡ç†å’ŒæŒä¹…åŒ–ä¿æŠ¤ï¼

